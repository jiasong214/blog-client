{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst assert_1 = __importDefault(require(\"assert\"));\n\nconst React = __importStar(require(\"react\"));\n\nconst LinkEditor_1 = __importDefault(require(\"./LinkEditor\"));\n\nconst FloatingToolbar_1 = __importDefault(require(\"./FloatingToolbar\"));\n\nconst createAndInsertLink_1 = __importDefault(require(\"../commands/createAndInsertLink\"));\n\nfunction isActive(props) {\n  const {\n    view\n  } = props;\n  const {\n    selection\n  } = view.state;\n\n  try {\n    const paragraph = view.domAtPos(selection.from);\n    return props.isActive && !!paragraph.node;\n  } catch (err) {\n    return false;\n  }\n}\n\nclass LinkToolbar extends React.Component {\n  constructor() {\n    super(...arguments);\n    this.menuRef = React.createRef();\n    this.state = {\n      left: -1000,\n      top: undefined\n    };\n\n    this.handleClickOutside = ev => {\n      if (ev.target && this.menuRef.current && this.menuRef.current.contains(ev.target)) {\n        return;\n      }\n\n      this.props.onClose();\n    };\n\n    this.handleOnCreateLink = async title => {\n      const {\n        dictionary,\n        onCreateLink,\n        view,\n        onClose,\n        onShowToast\n      } = this.props;\n      onClose();\n      this.props.view.focus();\n\n      if (!onCreateLink) {\n        return;\n      }\n\n      const {\n        dispatch,\n        state\n      } = view;\n      const {\n        from,\n        to\n      } = state.selection;\n      assert_1.default(from === to);\n      const href = `creating#${title}…`;\n      dispatch(view.state.tr.insertText(title, from, to).addMark(from, to + title.length, state.schema.marks.link.create({\n        href\n      })));\n      createAndInsertLink_1.default(view, title, href, {\n        onCreateLink,\n        onShowToast,\n        dictionary\n      });\n    };\n\n    this.handleOnSelectLink = ({\n      href,\n      title\n    }) => {\n      const {\n        view,\n        onClose\n      } = this.props;\n      onClose();\n      this.props.view.focus();\n      const {\n        dispatch,\n        state\n      } = view;\n      const {\n        from,\n        to\n      } = state.selection;\n      assert_1.default(from === to);\n      dispatch(view.state.tr.insertText(title, from, to).addMark(from, to + title.length, state.schema.marks.link.create({\n        href\n      })));\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  render() {\n    const _a = this.props,\n          {\n      onCreateLink,\n      onClose\n    } = _a,\n          rest = __rest(_a, [\"onCreateLink\", \"onClose\"]);\n\n    const {\n      selection\n    } = this.props.view.state;\n    const active = isActive(this.props);\n    return React.createElement(FloatingToolbar_1.default, Object.assign({\n      ref: this.menuRef,\n      active: active\n    }, rest), active && React.createElement(LinkEditor_1.default, Object.assign({\n      from: selection.from,\n      to: selection.to,\n      onCreateLink: onCreateLink ? this.handleOnCreateLink : undefined,\n      onSelectLink: this.handleOnSelectLink,\n      onRemoveLink: onClose\n    }, rest)));\n  }\n\n}\n\nexports.default = LinkToolbar;","map":{"version":3,"sources":["../../src/components/LinkToolbar.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAA,QAAA,GAAA,eAAA,CAAA,OAAA,CAAA,QAAA,CAAA,CAAA;;AACA,MAAA,KAAA,GAAA,YAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;;AAEA,MAAA,YAAA,GAAA,eAAA,CAAA,OAAA,CAAA,cAAA,CAAA,CAAA;;AACA,MAAA,iBAAA,GAAA,eAAA,CAAA,OAAA,CAAA,mBAAA,CAAA,CAAA;;AACA,MAAA,qBAAA,GAAA,eAAA,CAAA,OAAA,CAAA,iCAAA,CAAA,CAAA;;AAeA,SAAS,QAAT,CAAkB,KAAlB,EAA8B;AAC5B,QAAM;AAAE,IAAA;AAAF,MAAW,KAAjB;AACA,QAAM;AAAE,IAAA;AAAF,MAAgB,IAAI,CAAC,KAA3B;;AAEA,MAAI;AACF,UAAM,SAAS,GAAG,IAAI,CAAC,QAAL,CAAc,SAAS,CAAC,IAAxB,CAAlB;AACA,WAAO,KAAK,CAAC,QAAN,IAAkB,CAAC,CAAC,SAAS,CAAC,IAArC;AACD,GAHD,CAGE,OAAO,GAAP,EAAY;AACZ,WAAO,KAAP;AACD;AACF;;AAED,MAAqB,WAArB,SAAyC,KAAK,CAAC,SAA/C,CAA+D;AAA/D,EAAA,WAAA,GAAA;;AACE,SAAA,OAAA,GAAU,KAAK,CAAC,SAAN,EAAV;AAEA,SAAA,KAAA,GAAQ;AACN,MAAA,IAAI,EAAE,CAAC,IADD;AAEN,MAAA,GAAG,EAAE;AAFC,KAAR;;AAaA,SAAA,kBAAA,GAAqB,EAAE,IAAG;AACxB,UACE,EAAE,CAAC,MAAH,IACA,KAAK,OAAL,CAAa,OADb,IAEA,KAAK,OAAL,CAAa,OAAb,CAAqB,QAArB,CAA8B,EAAE,CAAC,MAAjC,CAHF,EAIE;AACA;AACD;;AAED,WAAK,KAAL,CAAW,OAAX;AACD,KAVD;;AAYA,SAAA,kBAAA,GAAqB,MAAO,KAAP,IAAwB;AAC3C,YAAM;AAAE,QAAA,UAAF;AAAc,QAAA,YAAd;AAA4B,QAAA,IAA5B;AAAkC,QAAA,OAAlC;AAA2C,QAAA;AAA3C,UAA2D,KAAK,KAAtE;AAEA,MAAA,OAAO;AACP,WAAK,KAAL,CAAW,IAAX,CAAgB,KAAhB;;AAEA,UAAI,CAAC,YAAL,EAAmB;AACjB;AACD;;AAED,YAAM;AAAE,QAAA,QAAF;AAAY,QAAA;AAAZ,UAAsB,IAA5B;AACA,YAAM;AAAE,QAAA,IAAF;AAAQ,QAAA;AAAR,UAAe,KAAK,CAAC,SAA3B;AACA,MAAA,QAAA,CAAA,OAAA,CAAO,IAAI,KAAK,EAAhB;AAEA,YAAM,IAAI,GAAG,YAAY,KAAK,GAA9B;AAGA,MAAA,QAAQ,CACN,IAAI,CAAC,KAAL,CAAW,EAAX,CACG,UADH,CACc,KADd,EACqB,IADrB,EAC2B,EAD3B,EAEG,OAFH,CAGI,IAHJ,EAII,EAAE,GAAG,KAAK,CAAC,MAJf,EAKI,KAAK,CAAC,MAAN,CAAa,KAAb,CAAmB,IAAnB,CAAwB,MAAxB,CAA+B;AAAE,QAAA;AAAF,OAA/B,CALJ,CADM,CAAR;AAUA,MAAA,qBAAA,CAAA,OAAA,CAAoB,IAApB,EAA0B,KAA1B,EAAiC,IAAjC,EAAuC;AACrC,QAAA,YADqC;AAErC,QAAA,WAFqC;AAGrC,QAAA;AAHqC,OAAvC;AAKD,KAhCD;;AAkCA,SAAA,kBAAA,GAAqB,CAAC;AACpB,MAAA,IADoB;AAEpB,MAAA;AAFoB,KAAD,KAQhB;AACH,YAAM;AAAE,QAAA,IAAF;AAAQ,QAAA;AAAR,UAAoB,KAAK,KAA/B;AAEA,MAAA,OAAO;AACP,WAAK,KAAL,CAAW,IAAX,CAAgB,KAAhB;AAEA,YAAM;AAAE,QAAA,QAAF;AAAY,QAAA;AAAZ,UAAsB,IAA5B;AACA,YAAM;AAAE,QAAA,IAAF;AAAQ,QAAA;AAAR,UAAe,KAAK,CAAC,SAA3B;AACA,MAAA,QAAA,CAAA,OAAA,CAAO,IAAI,KAAK,EAAhB;AAEA,MAAA,QAAQ,CACN,IAAI,CAAC,KAAL,CAAW,EAAX,CACG,UADH,CACc,KADd,EACqB,IADrB,EAC2B,EAD3B,EAEG,OAFH,CAGI,IAHJ,EAII,EAAE,GAAG,KAAK,CAAC,MAJf,EAKI,KAAK,CAAC,MAAN,CAAa,KAAb,CAAmB,IAAnB,CAAwB,MAAxB,CAA+B;AAAE,QAAA;AAAF,OAA/B,CALJ,CADM,CAAR;AASD,KA3BD;AAiDD;;AAvGC,EAAA,iBAAiB,GAAA;AACf,IAAA,MAAM,CAAC,gBAAP,CAAwB,WAAxB,EAAqC,KAAK,kBAA1C;AACD;;AAED,EAAA,oBAAoB,GAAA;AAClB,IAAA,MAAM,CAAC,mBAAP,CAA2B,WAA3B,EAAwC,KAAK,kBAA7C;AACD;;AA6ED,EAAA,MAAM,GAAA;AACJ,UAAM,EAAA,GAAqC,KAAK,KAAhD;AAAA,UAAM;AAAE,MAAA,YAAF;AAAgB,MAAA;AAAhB,QAAuB,EAA7B;AAAA,UAAkC,IAAI,GAAA,MAAA,CAAA,EAAA,EAAhC,CAAA,cAAA,EAAA,SAAA,CAAgC,CAAtC;;AACA,UAAM;AAAE,MAAA;AAAF,QAAgB,KAAK,KAAL,CAAW,IAAX,CAAgB,KAAtC;AACA,UAAM,MAAM,GAAG,QAAQ,CAAC,KAAK,KAAN,CAAvB;AAEA,WACE,KAAA,CAAA,aAAA,CAAC,iBAAA,CAAA,OAAD,EAAgB,MAAA,CAAA,MAAA,CAAA;AAAC,MAAA,GAAG,EAAE,KAAK,OAAX;AAAoB,MAAA,MAAM,EAAE;AAA5B,KAAA,EAAwC,IAAxC,CAAhB,EACG,MAAM,IACL,KAAA,CAAA,aAAA,CAAC,YAAA,CAAA,OAAD,EAAW,MAAA,CAAA,MAAA,CAAA;AACT,MAAA,IAAI,EAAE,SAAS,CAAC,IADP;AAET,MAAA,EAAE,EAAE,SAAS,CAAC,EAFL;AAGT,MAAA,YAAY,EAAE,YAAY,GAAG,KAAK,kBAAR,GAA6B,SAH9C;AAIT,MAAA,YAAY,EAAE,KAAK,kBAJV;AAKT,MAAA,YAAY,EAAE;AALL,KAAA,EAML,IANK,CAAX,CAFJ,CADF;AAcD;;AA9G4D;;AAA/D,OAAA,CAAA,OAAA,GAAA,WAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst assert_1 = __importDefault(require(\"assert\"));\nconst React = __importStar(require(\"react\"));\nconst LinkEditor_1 = __importDefault(require(\"./LinkEditor\"));\nconst FloatingToolbar_1 = __importDefault(require(\"./FloatingToolbar\"));\nconst createAndInsertLink_1 = __importDefault(require(\"../commands/createAndInsertLink\"));\nfunction isActive(props) {\n    const { view } = props;\n    const { selection } = view.state;\n    try {\n        const paragraph = view.domAtPos(selection.from);\n        return props.isActive && !!paragraph.node;\n    }\n    catch (err) {\n        return false;\n    }\n}\nclass LinkToolbar extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.menuRef = React.createRef();\n        this.state = {\n            left: -1000,\n            top: undefined,\n        };\n        this.handleClickOutside = ev => {\n            if (ev.target &&\n                this.menuRef.current &&\n                this.menuRef.current.contains(ev.target)) {\n                return;\n            }\n            this.props.onClose();\n        };\n        this.handleOnCreateLink = async (title) => {\n            const { dictionary, onCreateLink, view, onClose, onShowToast } = this.props;\n            onClose();\n            this.props.view.focus();\n            if (!onCreateLink) {\n                return;\n            }\n            const { dispatch, state } = view;\n            const { from, to } = state.selection;\n            assert_1.default(from === to);\n            const href = `creating#${title}…`;\n            dispatch(view.state.tr\n                .insertText(title, from, to)\n                .addMark(from, to + title.length, state.schema.marks.link.create({ href })));\n            createAndInsertLink_1.default(view, title, href, {\n                onCreateLink,\n                onShowToast,\n                dictionary,\n            });\n        };\n        this.handleOnSelectLink = ({ href, title, }) => {\n            const { view, onClose } = this.props;\n            onClose();\n            this.props.view.focus();\n            const { dispatch, state } = view;\n            const { from, to } = state.selection;\n            assert_1.default(from === to);\n            dispatch(view.state.tr\n                .insertText(title, from, to)\n                .addMark(from, to + title.length, state.schema.marks.link.create({ href })));\n        };\n    }\n    componentDidMount() {\n        window.addEventListener(\"mousedown\", this.handleClickOutside);\n    }\n    componentWillUnmount() {\n        window.removeEventListener(\"mousedown\", this.handleClickOutside);\n    }\n    render() {\n        const _a = this.props, { onCreateLink, onClose } = _a, rest = __rest(_a, [\"onCreateLink\", \"onClose\"]);\n        const { selection } = this.props.view.state;\n        const active = isActive(this.props);\n        return (React.createElement(FloatingToolbar_1.default, Object.assign({ ref: this.menuRef, active: active }, rest), active && (React.createElement(LinkEditor_1.default, Object.assign({ from: selection.from, to: selection.to, onCreateLink: onCreateLink ? this.handleOnCreateLink : undefined, onSelectLink: this.handleOnSelectLink, onRemoveLink: onClose }, rest)))));\n    }\n}\nexports.default = LinkToolbar;\n//# sourceMappingURL=LinkToolbar.js.map"]},"metadata":{},"sourceType":"script"}