{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst prosemirror_state_1 = require(\"prosemirror-state\");\n\nconst prosemirror_tables_1 = require(\"prosemirror-tables\");\n\nconst prosemirror_commands_1 = require(\"prosemirror-commands\");\n\nconst Extension_1 = __importDefault(require(\"../lib/Extension\"));\n\nconst isUrl_1 = __importDefault(require(\"../lib/isUrl\"));\n\nconst isInCode_1 = __importDefault(require(\"../queries/isInCode\"));\n\nfunction normalizePastedMarkdown(text) {\n  const CHECKBOX_REGEX = /^\\s?(\\[(X|\\s|_|-)\\]\\s(.*)?)/gim;\n\n  while (text.match(CHECKBOX_REGEX)) {\n    text = text.replace(CHECKBOX_REGEX, match => `- ${match.trim()}`);\n  }\n\n  return text;\n}\n\nclass MarkdownPaste extends Extension_1.default {\n  get name() {\n    return \"markdown-paste\";\n  }\n\n  get plugins() {\n    return [new prosemirror_state_1.Plugin({\n      props: {\n        handlePaste: (view, event) => {\n          if (view.props.editable && !view.props.editable(view.state)) {\n            return false;\n          }\n\n          if (!event.clipboardData) return false;\n          const text = event.clipboardData.getData(\"text/plain\");\n          const html = event.clipboardData.getData(\"text/html\");\n          const {\n            state,\n            dispatch\n          } = view;\n\n          if (isUrl_1.default(text)) {\n            if (!state.selection.empty) {\n              prosemirror_commands_1.toggleMark(this.editor.schema.marks.link, {\n                href: text\n              })(state, dispatch);\n              return true;\n            }\n\n            const {\n              embeds\n            } = this.editor.props;\n\n            if (embeds && !prosemirror_tables_1.isInTable(state)) {\n              for (const embed of embeds) {\n                const matches = embed.matcher(text);\n\n                if (matches) {\n                  this.editor.commands.embed({\n                    href: text,\n                    component: embed.component,\n                    matches\n                  });\n                  return true;\n                }\n              }\n            }\n\n            const transaction = view.state.tr.insertText(text, state.selection.from, state.selection.to).addMark(state.selection.from, state.selection.to + text.length, state.schema.marks.link.create({\n              href: text\n            }));\n            view.dispatch(transaction);\n            return true;\n          }\n\n          if (text.length === 0 || html && html.includes(\"data-pm-slice\")) {\n            return false;\n          }\n\n          event.preventDefault();\n\n          if (isInCode_1.default(view.state)) {\n            view.dispatch(view.state.tr.insertText(text));\n            return true;\n          }\n\n          const paste = this.editor.parser.parse(normalizePastedMarkdown(text));\n          const slice = paste.slice(0);\n          const transaction = view.state.tr.replaceSelection(slice);\n          view.dispatch(transaction);\n          return true;\n        }\n      }\n    })];\n  }\n\n}\n\nexports.default = MarkdownPaste;","map":{"version":3,"sources":["../../src/plugins/MarkdownPaste.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst prosemirror_state_1 = require(\"prosemirror-state\");\nconst prosemirror_tables_1 = require(\"prosemirror-tables\");\nconst prosemirror_commands_1 = require(\"prosemirror-commands\");\nconst Extension_1 = __importDefault(require(\"../lib/Extension\"));\nconst isUrl_1 = __importDefault(require(\"../lib/isUrl\"));\nconst isInCode_1 = __importDefault(require(\"../queries/isInCode\"));\nfunction normalizePastedMarkdown(text) {\n    const CHECKBOX_REGEX = /^\\s?(\\[(X|\\s|_|-)\\]\\s(.*)?)/gim;\n    while (text.match(CHECKBOX_REGEX)) {\n        text = text.replace(CHECKBOX_REGEX, match => `- ${match.trim()}`);\n    }\n    return text;\n}\nclass MarkdownPaste extends Extension_1.default {\n    get name() {\n        return \"markdown-paste\";\n    }\n    get plugins() {\n        return [\n            new prosemirror_state_1.Plugin({\n                props: {\n                    handlePaste: (view, event) => {\n                        if (view.props.editable && !view.props.editable(view.state)) {\n                            return false;\n                        }\n                        if (!event.clipboardData)\n                            return false;\n                        const text = event.clipboardData.getData(\"text/plain\");\n                        const html = event.clipboardData.getData(\"text/html\");\n                        const { state, dispatch } = view;\n                        if (isUrl_1.default(text)) {\n                            if (!state.selection.empty) {\n                                prosemirror_commands_1.toggleMark(this.editor.schema.marks.link, { href: text })(state, dispatch);\n                                return true;\n                            }\n                            const { embeds } = this.editor.props;\n                            if (embeds && !prosemirror_tables_1.isInTable(state)) {\n                                for (const embed of embeds) {\n                                    const matches = embed.matcher(text);\n                                    if (matches) {\n                                        this.editor.commands.embed({\n                                            href: text,\n                                            component: embed.component,\n                                            matches,\n                                        });\n                                        return true;\n                                    }\n                                }\n                            }\n                            const transaction = view.state.tr\n                                .insertText(text, state.selection.from, state.selection.to)\n                                .addMark(state.selection.from, state.selection.to + text.length, state.schema.marks.link.create({ href: text }));\n                            view.dispatch(transaction);\n                            return true;\n                        }\n                        if (text.length === 0 || (html && html.includes(\"data-pm-slice\"))) {\n                            return false;\n                        }\n                        event.preventDefault();\n                        if (isInCode_1.default(view.state)) {\n                            view.dispatch(view.state.tr.insertText(text));\n                            return true;\n                        }\n                        const paste = this.editor.parser.parse(normalizePastedMarkdown(text));\n                        const slice = paste.slice(0);\n                        const transaction = view.state.tr.replaceSelection(slice);\n                        view.dispatch(transaction);\n                        return true;\n                    },\n                },\n            }),\n        ];\n    }\n}\nexports.default = MarkdownPaste;\n//# sourceMappingURL=MarkdownPaste.js.map"]},"metadata":{},"sourceType":"script"}