{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst prosemirror_state_1 = require(\"prosemirror-state\");\n\nconst Extension_1 = __importDefault(require(\"../lib/Extension\"));\n\nclass TrailingNode extends Extension_1.default {\n  get name() {\n    return \"trailing_node\";\n  }\n\n  get defaultOptions() {\n    return {\n      node: \"paragraph\",\n      notAfter: [\"paragraph\", \"heading\"]\n    };\n  }\n\n  get plugins() {\n    const plugin = new prosemirror_state_1.PluginKey(this.name);\n    const disabledNodes = Object.entries(this.editor.schema.nodes).map(([, value]) => value).filter(node => this.options.notAfter.includes(node.name));\n    return [new prosemirror_state_1.Plugin({\n      key: plugin,\n      view: () => ({\n        update: view => {\n          const {\n            state\n          } = view;\n          const insertNodeAtEnd = plugin.getState(state);\n\n          if (!insertNodeAtEnd) {\n            return;\n          }\n\n          const {\n            doc,\n            schema,\n            tr\n          } = state;\n          const type = schema.nodes[this.options.node];\n          const transaction = tr.insert(doc.content.size, type.create());\n          view.dispatch(transaction);\n        }\n      }),\n      state: {\n        init: (_, state) => {\n          const lastNode = state.tr.doc.lastChild;\n          return lastNode ? !disabledNodes.includes(lastNode.type) : false;\n        },\n        apply: (tr, value) => {\n          if (!tr.docChanged) {\n            return value;\n          }\n\n          const lastNode = tr.doc.lastChild;\n          return lastNode ? !disabledNodes.includes(lastNode.type) : false;\n        }\n      }\n    })];\n  }\n\n}\n\nexports.default = TrailingNode;","map":{"version":3,"sources":["../../src/plugins/TrailingNode.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,MAAA,mBAAA,GAAA,OAAA,CAAA,mBAAA,CAAA;;AACA,MAAA,WAAA,GAAA,eAAA,CAAA,OAAA,CAAA,kBAAA,CAAA,CAAA;;AAEA,MAAqB,YAArB,SAA0C,WAAA,CAAA,OAA1C,CAAmD;AACzC,MAAJ,IAAI,GAAA;AACN,WAAO,eAAP;AACD;;AAEiB,MAAd,cAAc,GAAA;AAChB,WAAO;AACL,MAAA,IAAI,EAAE,WADD;AAEL,MAAA,QAAQ,EAAE,CAAC,WAAD,EAAc,SAAd;AAFL,KAAP;AAID;;AAEU,MAAP,OAAO,GAAA;AACT,UAAM,MAAM,GAAG,IAAI,mBAAA,CAAA,SAAJ,CAAc,KAAK,IAAnB,CAAf;AACA,UAAM,aAAa,GAAG,MAAM,CAAC,OAAP,CAAe,KAAK,MAAL,CAAY,MAAZ,CAAmB,KAAlC,EACnB,GADmB,CACf,CAAC,GAAG,KAAH,CAAD,KAAe,KADA,EAEnB,MAFmB,CAEZ,IAAI,IAAI,KAAK,OAAL,CAAa,QAAb,CAAsB,QAAtB,CAA+B,IAAI,CAAC,IAApC,CAFI,CAAtB;AAIA,WAAO,CACL,IAAI,mBAAA,CAAA,MAAJ,CAAW;AACT,MAAA,GAAG,EAAE,MADI;AAET,MAAA,IAAI,EAAE,OAAO;AACX,QAAA,MAAM,EAAE,IAAI,IAAG;AACb,gBAAM;AAAE,YAAA;AAAF,cAAY,IAAlB;AACA,gBAAM,eAAe,GAAG,MAAM,CAAC,QAAP,CAAgB,KAAhB,CAAxB;;AAEA,cAAI,CAAC,eAAL,EAAsB;AACpB;AACD;;AAED,gBAAM;AAAE,YAAA,GAAF;AAAO,YAAA,MAAP;AAAe,YAAA;AAAf,cAAsB,KAA5B;AACA,gBAAM,IAAI,GAAG,MAAM,CAAC,KAAP,CAAa,KAAK,OAAL,CAAa,IAA1B,CAAb;AACA,gBAAM,WAAW,GAAG,EAAE,CAAC,MAAH,CAAU,GAAG,CAAC,OAAJ,CAAY,IAAtB,EAA4B,IAAI,CAAC,MAAL,EAA5B,CAApB;AACA,UAAA,IAAI,CAAC,QAAL,CAAc,WAAd;AACD;AAbU,OAAP,CAFG;AAiBT,MAAA,KAAK,EAAE;AACL,QAAA,IAAI,EAAE,CAAC,CAAD,EAAI,KAAJ,KAAa;AACjB,gBAAM,QAAQ,GAAG,KAAK,CAAC,EAAN,CAAS,GAAT,CAAa,SAA9B;AACA,iBAAO,QAAQ,GAAG,CAAC,aAAa,CAAC,QAAd,CAAuB,QAAQ,CAAC,IAAhC,CAAJ,GAA4C,KAA3D;AACD,SAJI;AAKL,QAAA,KAAK,EAAE,CAAC,EAAD,EAAK,KAAL,KAAc;AACnB,cAAI,CAAC,EAAE,CAAC,UAAR,EAAoB;AAClB,mBAAO,KAAP;AACD;;AAED,gBAAM,QAAQ,GAAG,EAAE,CAAC,GAAH,CAAO,SAAxB;AACA,iBAAO,QAAQ,GAAG,CAAC,aAAa,CAAC,QAAd,CAAuB,QAAQ,CAAC,IAAhC,CAAJ,GAA4C,KAA3D;AACD;AAZI;AAjBE,KAAX,CADK,CAAP;AAkCD;;AApDgD;;AAAnD,OAAA,CAAA,OAAA,GAAA,YAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst prosemirror_state_1 = require(\"prosemirror-state\");\nconst Extension_1 = __importDefault(require(\"../lib/Extension\"));\nclass TrailingNode extends Extension_1.default {\n    get name() {\n        return \"trailing_node\";\n    }\n    get defaultOptions() {\n        return {\n            node: \"paragraph\",\n            notAfter: [\"paragraph\", \"heading\"],\n        };\n    }\n    get plugins() {\n        const plugin = new prosemirror_state_1.PluginKey(this.name);\n        const disabledNodes = Object.entries(this.editor.schema.nodes)\n            .map(([, value]) => value)\n            .filter(node => this.options.notAfter.includes(node.name));\n        return [\n            new prosemirror_state_1.Plugin({\n                key: plugin,\n                view: () => ({\n                    update: view => {\n                        const { state } = view;\n                        const insertNodeAtEnd = plugin.getState(state);\n                        if (!insertNodeAtEnd) {\n                            return;\n                        }\n                        const { doc, schema, tr } = state;\n                        const type = schema.nodes[this.options.node];\n                        const transaction = tr.insert(doc.content.size, type.create());\n                        view.dispatch(transaction);\n                    },\n                }),\n                state: {\n                    init: (_, state) => {\n                        const lastNode = state.tr.doc.lastChild;\n                        return lastNode ? !disabledNodes.includes(lastNode.type) : false;\n                    },\n                    apply: (tr, value) => {\n                        if (!tr.docChanged) {\n                            return value;\n                        }\n                        const lastNode = tr.doc.lastChild;\n                        return lastNode ? !disabledNodes.includes(lastNode.type) : false;\n                    },\n                },\n            }),\n        ];\n    }\n}\nexports.default = TrailingNode;\n//# sourceMappingURL=TrailingNode.js.map"]},"metadata":{},"sourceType":"script"}