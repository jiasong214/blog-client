(this["webpackJsonpblog-by-jia"]=this["webpackJsonpblog-by-jia"]||[]).push([[1],{17:function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return h}));var r=n(2),c=n.n(r),a=n(5),o=n(16),u=n(0),s=n(1),i=Object(u.createContext)({}),p=function(t){var e=t.authService,n=t.children,r=Object(u.useState)(void 0),p=Object(o.a)(r,2),h=p[0],f=p[1];Object(u.useEffect)((function(){e.me().then((function(t){return f(t)}))}),[e]);var b=Object(u.useCallback)(function(){var t=Object(a.a)(c.a.mark((function t(n,r){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.login(n,r).then((function(t){return f(t)}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),[e]),j=Object(u.useCallback)(Object(a.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.logout().then((function(){return f(void 0)}));case 1:case"end":return t.stop()}}),t)}))),[e]),l=Object(u.useMemo)((function(){return{user:h,onLogin:b,onLogout:j}}),[h,b,j]);return Object(s.jsx)(i.Provider,{value:l,children:n})},h=function(){return Object(u.useContext)(i)}},34:function(t,e,n){},39:function(t,e,n){"use strict";n.r(e);var r=n(0),c=n.n(r),a=n(25),o=n.n(a),u=n(10),s=n(15),i=n(16),p=n(3),h=n(17),f=(n(34),n(1)),b=function(){var t=Object(p.f)(),e=Object(h.b)(),n=e.user,r=e.onLogout;return Object(f.jsxs)("footer",{className:"footer",children:[n&&n.token?Object(f.jsx)("div",{className:"footer__logout",onClick:function(){window.confirm("Do you want to log out?")&&(r(),t.push("/"))},children:"Logout Admin"}):Object(f.jsx)(u.b,{className:"footer__login",to:"/login",children:"Admin account"}),Object(f.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Jia Song"})]})},j=Object(r.lazy)((function(){return n.e(5).then(n.bind(null,539))})),l=Object(r.lazy)((function(){return Promise.all([n.e(0),n.e(4)]).then(n.bind(null,541))})),d=Object(r.lazy)((function(){return n.e(7).then(n.bind(null,537))})),O=Object(r.lazy)((function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,538))}));var v=function(t){var e=t.postService,n=Object(r.useState)([]),c=Object(i.a)(n,2),a=c[0],o=c[1];return Object(r.useEffect)((function(){e.getPosts().then((function(t){return o((function(e){return Object(s.a)(new Set([].concat(Object(s.a)(e),Object(s.a)(t))))}))})).catch(console.error)}),[e]),Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)(r.Suspense,{fallback:Object(f.jsx)("div",{children:"Loading..... "}),children:Object(f.jsxs)(p.c,{children:[Object(f.jsx)(p.a,{exact:!0,path:"/",children:Object(f.jsx)(j,{postService:e,posts:a})}),Object(f.jsx)(p.a,{exact:!0,path:"/post/compose",children:Object(f.jsx)(O,{postService:e,createPost:function(t){o((function(){return[t].concat(Object(s.a)(a))}))},updatePost:function(t,e){o((function(){return a.map((function(n){return parseInt(n.id)===parseInt(t)?e:n}))}))}})}),Object(f.jsx)(p.a,{exact:!0,path:"/post/:id",children:Object(f.jsx)(l,{postService:e,deletePost:function(t){o((function(){return a.filter((function(e){return parseInt(e.id)!==parseInt(t)}))}))}})}),Object(f.jsx)(p.a,{exact:!0,path:"/post/:id/edit",children:Object(f.jsx)(O,{postService:e})}),Object(f.jsx)(p.a,{exact:!0,path:"/login",component:d})]})}),Object(f.jsx)(b,{})]})},x=n(2),m=n.n(x),y=n(18),w=n(5),g=n(11),k=n(12),S=function(){function t(e){Object(g.a)(this,t),this.baseURL=e}return Object(k.a)(t,[{key:"fetch",value:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=Object(w.a)(m.a.mark((function t(e,n){var r,c,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(this.baseURL).concat(e),Object(y.a)(Object(y.a)({},n),{},{headers:Object(y.a)({"Content-Type":"application/json",mode:"no-cors"},n.headers),credentials:"include"}));case 2:return r=t.sent,t.prev=3,t.next=6,r.json();case 6:c=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),console.error(t.t0);case 12:if(!(r.status>299||r.status<200)){t.next=15;break}return a=c&&c.message?c.message:"http error!",t.abrupt("return",new Error(a));case 15:return t.abrupt("return",c);case 16:case"end":return t.stop()}}),t,this,[[3,9]])})));return function(e,n){return t.apply(this,arguments)}}())}]),t}(),P=function(){function t(e){Object(g.a)(this,t),this.http=e}return Object(k.a)(t,[{key:"getPosts",value:function(){var t=Object(w.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/posts",{method:"GET"}));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getPostById",value:function(){var t=Object(w.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/posts/".concat(e),{method:"GET"}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createPost",value:function(){var t=Object(w.a)(m.a.mark((function t(e,n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/posts",{method:"POST",body:JSON.stringify({title:e,text:n})}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"updatePost",value:function(){var t=Object(w.a)(m.a.mark((function t(e,n,r){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/posts/".concat(e),{method:"PUT",body:JSON.stringify({title:n,text:r})}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"deletePost",value:function(){var t=Object(w.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/posts/".concat(e),{method:"DELETE"}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),E=function(){function t(e){Object(g.a)(this,t),this.http=e}return Object(k.a)(t,[{key:"login",value:function(){var t=Object(w.a)(m.a.mark((function t(e,n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/auth/login",{method:"POST",body:JSON.stringify({username:e,password:n})}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"logout",value:function(){var t=Object(w.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/auth/logout",{method:"POST"}));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"me",value:function(){var t=Object(w.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.fetch("/auth/me",{method:"GET"}));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),T=new S("https://jia-blog.herokuapp.com"),L=new P(T),N=new E(T);o.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(u.a,{children:Object(f.jsx)(h.a,{authService:N,children:Object(f.jsx)(v,{postService:L})})})}),document.getElementById("root"))}},[[39,2,3]]]);
//# sourceMappingURL=main.2afe90cb.chunk.js.map