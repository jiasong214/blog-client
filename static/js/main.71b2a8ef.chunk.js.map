{"version":3,"sources":["context/AuthContext.jsx","components/Footer.jsx","hooks/usePost.jsx","App.js","network/http.js","service/post.js","service/auth.js","index.js"],"names":["AuthContext","createContext","AuthProvider","authService","children","useState","undefined","user","setUser","useEffect","me","then","data","onLogin","useCallback","username","password","a","login","onLogout","logout","context","useMemo","Provider","value","useAuth","useContext","Footer","history","useHistory","className","token","onClick","window","confirm","push","to","usePost","postService","postsNumber","loading","setLoading","error","setError","posts","setPosts","total","setTotal","getPosts","result","Set","catch","createPost","post","updatePost","id","updated","map","parseInt","deletePost","filter","Main","lazy","Post","Login","CreatePost","App","setPostsNumber","fallback","exact","path","changePostsNumber","component","HttpClient","baseURL","this","url","options","fetch","headers","credentials","res","json","console","status","message","Error","PostService","http","start","method","title","text","body","JSON","stringify","AuthService","httpClient","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.71b2a8ef.chunk.js","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo, createContext, useContext } from 'react';\n\nexport const AuthContext = createContext({});\n\nexport const AuthProvider = ({authService, children}) => {\n  const [user, setUser] = useState(undefined);\n\n  useEffect(() => {\n    authService\n      .me()\n      .then((data) => setUser(data));\n  }, [authService]);\n\n  const onLogin = useCallback(async (username, password) => {\n    authService\n      .login(username, password)\n      .then((data) => setUser(data))\n  }, [authService])\n\n  const onLogout = useCallback(async () => {\n    authService\n      .logout()\n      .then(() => setUser(undefined));\n  }, [authService])\n\n  const context = useMemo(() => ({\n    user, onLogin, onLogout\n  }), [user, onLogin, onLogout])\n\n  return (\n    <AuthContext.Provider value={context}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport const useAuth = () => useContext(AuthContext);","import React from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport '../style/footer.scss';\n\nconst Footer = () => {\n  const history = useHistory();\n  const { user, onLogout } = useAuth();\n\n  const onClickLogout = () => {\n    if (window.confirm('Do you want to log out?')) {\n      onLogout();\n      history.push('/');\n    }\n  }\n\n  return (\n    <footer className=\"footer\">\n       {user ? user.token ? \n          <div className='footer__logout' onClick={onClickLogout}>Logout Admin</div> : \n          <Link className=\"footer__login\" to='/login'>Admin account</Link> :\n          <Link className=\"footer__login\" to='/login'>Admin account</Link>\n        }\n      <p className=\"footer__copyright\">\n        &copy; 2021 Jia Song\n      </p>\n    </footer>\n  )\n}\n\nexport default Footer;","import { useState, useEffect } from 'react';\n\n\nconst usePost = ({postService, postsNumber}) => {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [posts, setPosts] = useState([]);\n  const [total, setTotal] = useState(0);\n\n  //load new data whenever postsNumber is changed\n  useEffect(() => {\n    setLoading(true);\n    setError(false);\n\n    postService\n      .getPosts(postsNumber)\n      .then(result => {\n        setTotal(result.total);\n        return result.data;\n      })\n      .then((data) => setPosts((posts) => [...new Set([...posts, ...data])]))\n      .then(() => setLoading(false))\n      .catch(() => setError(true));\n  }, [postService, postsNumber])\n\n\n  const deletePost = (id) => {\n    setPosts(() => posts.filter((post) => parseInt(post.id) !== parseInt(id)));\n  };\n\n  const createPost = (post) => {\n    setPosts(() => [post, ...posts]);\n  };\n\n  const updatePost = (id, updated) => {\n    setPosts(() => posts.map((post) => parseInt(post.id) === parseInt(id) ? updated : post));\n  };\n\n  return { posts, total, loading, error, createPost, updatePost, deletePost }\n}\n\nexport default usePost;","import React, { useState, lazy, Suspense } from 'react';\nimport { Route, Switch } from 'react-router-dom';\nimport Footer from './components/Footer';\nimport usePost from './hooks/usePost';\n\nconst Main = lazy(() => import('./pages/Main'));\nconst Post = lazy(() => import('./pages/Post'));\nconst Login = lazy(() => import('./pages/Login'));\nconst CreatePost = lazy(() => import('./pages/CreatePost'));\n\nfunction App({postService}) {\n  const [postsNumber, setPostsNumber] = useState(0);\n\n  const { \n    loading,\n    error,\n    posts,\n    total,\n    createPost,\n    updatePost,\n    deletePost\n   } = usePost({postService, postsNumber});\n\n  const changePostsNumber = () => {\n    setPostsNumber((postsNumber) => postsNumber + 4);\n  }\n\n  return (\n    <div className=\"App\">\n      <Suspense fallback={<div>Loading..... suspense...</div>}>\n        <Switch>\n\n          {/* main: all posts */}\n          <Route exact path=\"/\">\n            <Main \n              postService={postService}  \n              changePostsNumber={changePostsNumber}\n              posts={posts}\n              total={total}\n              loading={loading}\n              error={error}\n            />\n          </Route>\n\n          {/* create post page */}\n          <Route exact path=\"/post/compose\">\n            <CreatePost \n              postService={postService} \n              createPost={createPost}\n              updatePost={updatePost}\n            />\n          </Route>\n\n          {/* post(id) page */}\n          <Route exact path=\"/post/:id\">\n            <Post \n              postService={postService} \n              deletePost={deletePost}\n            />\n          </Route>\n\n          {/* edit post(id)  */}\n          <Route exact path=\"/post/:id/edit\">\n            <CreatePost postService={postService} />\n          </Route>\n\n          {/* login page  */}\n          <Route exact path=\"/login\" component={Login} />\n\n        </Switch>\n      </Suspense>\n      <Footer />\n    </div>\n  );\n}\n\nexport default App;\n","export default class HttpClient {\n  constructor(baseURL) {\n    this.baseURL = baseURL;\n  }\n\n  async fetch(url, options) {\n    //set all http options, and fetch data\n    const res = await fetch(`${this.baseURL}${url}`, {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n      credentials: 'include',\n    });\n\n    //fomat data to json, and catch error\n    let data;\n    try {\n      data = await res.json();\n    } catch (error) {\n      console.error(error);\n    }\n\n    //if there is error in respond, throw error message\n    if (res.status > 299 || res.status < 200) {\n      const message =\n        data && data.message ? data.message : 'http error!';\n\n      return new Error(message);\n    }\n\n    //if everything is okay, return json data\n    return data;\n  }\n}\n","export default class PostService {\n  constructor (http) {\n    this.http = http;\n  }\n\n  async getPosts(start) {\n    return this.http.fetch(`/posts/start=${start}`, {\n      method: 'GET'\n    });\n  }\n\n  async getPostById(id) {\n    return this.http.fetch(`/posts/${id}`, {\n      method: 'GET',\n    });\n  }\n\n  async createPost(title, text) {\n    return this.http.fetch(`/posts`, {\n      method: 'POST',\n      body: JSON.stringify({ title, text })\n    });\n  }\n\n  async updatePost(id, title, text) {\n    return this.http.fetch(`/posts/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify({ title, text })\n    });\n  }\n\n  async deletePost(id) {\n    return this.http.fetch(`/posts/${id}`, {\n      method: 'DELETE',\n    });\n  }\n}","export default class AuthService {\n  constructor (http) {\n    this.http = http;\n  }\n\n  async login(username, password) {\n    return this.http.fetch(`/auth/login`, {\n      method: 'POST',\n      body: JSON.stringify({ username, password })\n    });\n  }\n\n  async logout() {\n    return this.http.fetch(`/auth/logout`, {\n      method: 'POST',\n    });\n  }\n\n  async me() { \n    return this.http.fetch(`/auth/me`, {\n      method: 'GET',\n    });\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\nimport App from './App';\nimport { AuthProvider } from './context/AuthContext';\nimport HttpClient from './network/http';\nimport PostService from './service/post.js';\nimport AuthService from './service/auth';\n\n//basic api url\n// const baseURL = 'https://jia-blog.herokuapp.com';\nconst baseURL = `http://localhost:8080`;\n\n//class that has http common option and error handling\nconst httpClient = new HttpClient(baseURL);\n\n//class that controll all post/auth related APIs\nconst postService = new PostService(httpClient);\nconst authService = new AuthService(httpClient);\n\n// //basic url\n// const routeBase = '/blog-client';\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <AuthProvider authService={authService}>\n        <App postService={postService} />\n      </AuthProvider>\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}